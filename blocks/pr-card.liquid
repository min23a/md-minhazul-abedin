{%- liquid
assign p = block.settings.product
assign x = block.settings.pos_x | default: 50
assign y = block.settings.pos_y | default: 50
assign uid = section.id | append: '-' | append: block.id
assign form_id = 'tpcForm-' | append: uid
-%}

{%- if p != blank -%}
{{ 'test-pr-card.css' | asset_url | stylesheet_tag }}


<div class="tpc">
  {%- if p.featured_media -%}
  {{ p.featured_media
  | image_url: width: 1600
  | image_tag:
  widths: '375, 550, 750, 990, 1200, 1600',
  sizes: '(min-width: 990px) 50vw, 100vw',
  loading: 'lazy',
  class: 'tpc__img'
  }}
  {%- endif -%}

  <tpc-hotspot class="tpcHotspot" style="--tpc-x: {{ x }}; --tpc-y: {{ y }};" data-tpc-id="{{ uid }}">
    <button class="tpcHotspot__pin" type="button" aria-haspopup="dialog" aria-controls="tpcModal-{{ uid }}"
      aria-expanded="false" data-tpc-open>
      <span class="tpcHotspot__plus" aria-hidden="true">+</span>
      <span class="visually-hidden">Open {{ p.title | escape }}</span>
    </button>

    <div class="tpcHotspot__backdrop" hidden data-tpc-close></div>
  </tpc-hotspot>
</div>

<div id="tpcModal-{{ uid }}" class="tpcModal" role="dialog" aria-modal="true" aria-label="{{ p.title | escape }}" hidden
  data-tpc-modal>
  <button class="tpcModal__close" type="button" aria-label="Close" data-tpc-close>Ã—</button>

  <div class="tpcModal__grid">
    <div class="tpcModal_upperGrid">
      <div class="tpcModal__media">
        {%- if p.featured_media -%}
        {{ p.featured_media
        | image_url: width: 800
        | image_tag:
        widths: '220, 330, 440, 660, 880',
        sizes: '(min-width: 990px) 220px, 160px',
        loading: 'lazy',
        class: 'tpcModal__img'
        }}
        {%- endif -%}
      </div>

      <div class="tpcModal__info">
        <h3 class="tpcModal__title">{{ p.title }}</h3>

        <div class="tpcModal__price">
          {{ p.selected_or_first_available_variant.price | money }}
        </div>

        {%- if p.description != blank -%}
        <div class="tpcModal__desc rte">
          {{ p.description | strip_html | truncate: 80 }}
        </div>
        {%- endif -%}
      </div>
    </div>

    {%- assign v = p.selected_or_first_available_variant -%}

    <product-form class="tpcModal__form" data-section-id="{{ section.id }}">
      {%- form 'product'
      , p
      , id: form_id
      , class: 'form'
      , novalidate: 'novalidate'
      , data-type: 'add-to-cart-form' -%}
      <input type="hidden" name="id" value="{{ v.id }}" data-tpc-variant-id>

      {%- unless p.has_only_default_variant -%}
      <div class="tpcModal__options">
        {%- render 'test-option'
        , p: p
        , uid: uid -%}
      </div>

      <script type="application/json" data-tpc-variants>
              {{ p.variants | json }}
            </script>
      {%- endunless -%}

      <button type="submit" name="add" class="button button--full-width tpcModal__atc">
        <span>Add to cart {{ 'icon-test-arrow.svg' | inline_asset_content }}</span>

        <div class="loading__spinner hidden" aria-hidden="true">
          <svg aria-hidden="true" focusable="false" class="spinner" viewBox="0 0 66 66"
            xmlns="http://www.w3.org/2000/svg">
            <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
          </svg>
        </div>
      </button>

      {%- endform -%}
    </product-form>
  </div>
</div>
{%- endif -%}

{% schema %}
{
"name": "Test Product Card",
"settings": [
{
"type": "product",
"id": "product",
"label": "Product"
}, {
"type": "range",
"id": "pos_x",
"label": "X position (%) from left",
"min": 0,
"max": 100,
"step": 1,
"default": 50
}, {
"type": "range",
"id": "pos_y",
"label": "Y position (%) from top",
"min": 0,
"max": 100,
"step": 1,
"default": 50
}
]
}
{% endschema %}